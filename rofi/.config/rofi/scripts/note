#!/usr/bin/env bash

# Rofi note launcher script for Obsidian + PARA method

VAULT_DIR="$HOME/second-brain"

# Ensure PARA directories exist
mkdir -p "$VAULT_DIR/temp"
mkdir -p "$VAULT_DIR/projects"
mkdir -p "$VAULT_DIR/areas"
mkdir -p "$VAULT_DIR/resources"

# Rofi menu options
options="Open Vault\n---\nQuick Note\nProject Note\nArea Note\nResource Note"

# Show rofi menu
choice=$(echo -e "$options" | rofi -dmenu -i -p "Notes" \
    -theme ~/.config/rofi/tokyonight.rasi \
    -theme-str 'window {width: 20%;} listview {lines: 6;}')

case "$choice" in
    "Open Vault")
        # Open Obsidian
        obsidian &
        ;;
    "Quick Note")
        # Generate timestamp filename: YYYY-MM-DD-HHMM.md
        timestamp=$(date +%Y-%m-%d-%H%M)
        note_file="$VAULT_DIR/temp/$timestamp.md"
        
        # Create with template
        echo "# Quick Note" > "$note_file"
        echo "" >> "$note_file"
        echo "tags: " >> "$note_file"
        echo "" >> "$note_file"
        echo "## Overview" >> "$note_file"
        echo "" >> "$note_file"
        
        # Open in Obsidian with the specific file
        obsidian "obsidian://open?vault=second-brain&file=temp/$timestamp.md" &
        ;;
    "Project Note")
        # Prompt for project name
        project_name=$(rofi -dmenu -p "Project Name" \
            -theme ~/.config/rofi/tokyonight.rasi \
            -theme-str 'window {width: 20%;} listview {lines: 0;}')
        
        if [ -n "$project_name" ]; then
            # Sanitize filename
            safe_name=$(echo "$project_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9-]//g')
            note_file="$VAULT_DIR/projects/$safe_name.md"
            
            # Create with template
            if [ ! -f "$note_file" ]; then
                echo "# $project_name" > "$note_file"
                echo "" >> "$note_file"
                echo "tags: " >> "$note_file"
                echo "" >> "$note_file"
                echo "## Overview" >> "$note_file"
                echo "" >> "$note_file"
            fi
            
            # Open in Obsidian
            obsidian "obsidian://open?vault=second-brain&file=projects/$safe_name.md" &
        fi
        ;;
    "Area Note")
        # Prompt for area name
        area_name=$(rofi -dmenu -p "Area Name" \
            -theme ~/.config/rofi/tokyonight.rasi \
            -theme-str 'window {width: 20%;} listview {lines: 0;}')
        
        if [ -n "$area_name" ]; then
            safe_name=$(echo "$area_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9-]//g')
            note_file="$VAULT_DIR/areas/$safe_name.md"
            
            # Create with template
            if [ ! -f "$note_file" ]; then
                echo "# $area_name" > "$note_file"
                echo "" >> "$note_file"
                echo "tags: " >> "$note_file"
                echo "" >> "$note_file"
                echo "## Overview" >> "$note_file"
                echo "" >> "$note_file"
            fi
            
            # Open in Obsidian
            obsidian "obsidian://open?vault=second-brain&file=areas/$safe_name.md" &
        fi
        ;;
    "Resource Note")
        # Prompt for resource name
        resource_name=$(rofi -dmenu -p "Resource Name" \
            -theme ~/.config/rofi/tokyonight.rasi \
            -theme-str 'window {width: 20%;} listview {lines: 0;}')
        
        if [ -n "$resource_name" ]; then
            safe_name=$(echo "$resource_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9-]//g')
            note_file="$VAULT_DIR/resources/$safe_name.md"
            
            # Create with template
            if [ ! -f "$note_file" ]; then
                echo "# $resource_name" > "$note_file"
                echo "" >> "$note_file"
                echo "tags: " >> "$note_file"
                echo "" >> "$note_file"
                echo "## Overview" >> "$note_file"
                echo "" >> "$note_file"
            fi
            
            # Open in Obsidian
            obsidian "obsidian://open?vault=second-brain&file=resources/$safe_name.md" &
        fi
        ;;
esac
